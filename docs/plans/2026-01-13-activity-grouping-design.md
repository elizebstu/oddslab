# Activity Grouping Design

## Overview

实现活动卡片分组折叠功能，将同一个地址在同一个市场的多笔交易折叠显示为堆叠卡片，点击可展开/收起。

## 分组逻辑

**分组条件**：`address + market (conditionId)`
- 同一个地址在同一个市场的所有交易（买入/卖出）会被分组
- 每个分组内按时间倒序排列，最新的交易在前

**数据结构**：
```typescript
interface ActivityGroup {
  key: string;                    // `${address}-${conditionId}`
  activities: Activity[];         // 原始活动列表
  latestActivity: Activity;       // 最新一笔交易
  totalBuyAmount: number;         // 买入总金额
  totalSellAmount: number;        // 卖出总金额
  buyCount: number;               // 买入次数
  sellCount: number;              // 卖出次数
}
```

## UI 设计

### 折叠状态

```
┌─────────────────────────────────────────────────────┐
│  ↑  马萨特兰足球俱乐部会在 2026 年 1 月 13 日获胜吗?    │
│     GAMBLINGISALLYOUNEED • 买入 • NO • $29.97        │
│     ─────────────────────────────────────────────    │
│     共 5 笔 | 买入: $110.16 (4次) | 卖出: $25.00 (1次) │
└─────────────────────────────────────────────────────┘
  └─ 偏移阴影层 1
    └─ 偏移阴影层 2
```

- 显示最新一笔交易的完整信息
- 底部汇总行显示：
  - 共 N 笔：总交易次数
  - 买入: $X (N次)：绿色
  - 卖出: $X (N次)：红色
- 如果只有买入/卖出，只显示对应项
- 物理堆叠效果：1-2层偏移阴影

### 展开状态

```
┌─────────────────────────────────────────────────────┐
│  ↑  马萨特兰足球俱乐部... • 买入 • NO • $29.97  [最新] │
├─────────────────────────────────────────────────────┤
│  ↓  马萨特兰足球俱乐部... • 卖出 • NO • $25.00        │
├─────────────────────────────────────────────────────┤
│  ↑  马萨特兰足球俱乐部... • 买入 • NO • $50.22        │
├─────────────────────────────────────────────────────┤
│  ↑  马萨特兰足球俱乐部... • 买入 • NO • $15.39        │
├─────────────────────────────────────────────────────┤
│  ↑  马萨特兰足球俱乐部... • 买入 • NO • $14.58        │
├─────────────────────────────────────────────────────┤
│     共 5 笔 | 买入: $110.16 (4次) | 卖出: $25.00 (1次) │
└─────────────────────────────────────────────────────┘
```

- 每笔交易独立显示，保留原有卡片样式
- ↑ 绿色箭头 = 买入，↓ 红色箭头 = 卖出
- 最新一笔右侧显示 [最新] 标签
- 按时间倒序排列（最新在上）
- 底部保留汇总信息
- 点击任意位置可收起

## 交互

- 点击折叠卡片 → 展开显示所有交易
- 点击展开卡片 → 收起回折叠状态
- 单笔交易的分组不显示堆叠效果，行为与现有一致

## 实现要点

1. 在 `RoomDetail.tsx` 中添加分组逻辑函数
2. 添加 `expandedGroups` state 管理展开状态
3. 使用 CSS 伪元素实现堆叠阴影效果
4. 保持现有筛选功能兼容
